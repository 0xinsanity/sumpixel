{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component, createContext } from \"react\";\nimport { myFirebase } from \"./firebase\";\nimport { getEmployer, getUser } from './server';\nimport Loading from '../components/General/Loading';\nexport const UserContext = createContext({\n  currentUser: null,\n  changeUser: () => {},\n  loading: false,\n  setLoading: () => {}\n});\n\nclass UserProvider extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"changeUser\", newUser => {\n      console.log('This is current: ' + newUser);\n      this.setState({\n        currentUser: newUser\n      });\n    });\n\n    _defineProperty(this, \"setLoading\", newLoad => {\n      this.setState({\n        loading: newLoad\n      });\n    });\n\n    _defineProperty(this, \"state\", {\n      loading: false,\n      currentUser: null,\n      changeUser: this.changeUser,\n      setLoading: this.setLoading\n    });\n\n    _defineProperty(this, \"componentDidMount\", () => {\n      myFirebase.auth().onAuthStateChanged(async userAuth => {\n        //this.setLoading(true)\n        if (userAuth === null) {\n          this.setLoading(false);\n          return;\n        }\n\n        if (userAuth.isAnonymous) {\n          console.log('userauth:' + userAuth);\n          this.changeUser({\n            firstName: '',\n            lastName: '',\n            email: '',\n            id: userAuth.uid,\n            isAnonymous: true\n          });\n          this.setLoading(false);\n          return;\n        } // This is some of the worst code I've ever made\n\n\n        var current;\n\n        try {\n          current = await getUser(userAuth.uid);\n        } catch (error) {\n          try {\n            current = await getEmployer(userAuth.uid);\n            current[\"user_exists\"] = false;\n          } catch (error) {\n            console.log(\"this better be a new user\");\n          }\n        }\n\n        if (current !== undefined && current['user_exists'] === undefined) {\n          this.changeUser(current);\n          window.analytics.identify(current.id, {\n            name: current.name,\n            email: current.email\n          });\n        } else if (current !== undefined && current['employer_exists'] === undefined) {\n          this.changeUser(current);\n          window.analytics.identify(current.id, {\n            name: current.name,\n            email: current.email\n          });\n        } else {\n          if (userAuth.email === null && userAuth.isAnonymous === false) {\n            // something's wrong\n            myFirebase.auth().signOut();\n            this.changeUser(undefined);\n            this.setLoading(false);\n            return;\n          } // In process of making account\n\n\n          console.log('name: ' + userAuth.displayName);\n          this.changeUser({\n            email: userAuth.email,\n            id: userAuth.uid,\n            firstName: userAuth.displayName.substr(0, userAuth.displayName.indexOf(' ')),\n            lastName: userAuth.displayName.substr(userAuth.displayName.indexOf(' ') + 1)\n          });\n          this.setLoading(false);\n        }\n      });\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(UserContext.Provider, {\n      value: this.state\n    }, /*#__PURE__*/React.createElement(Loading, {\n      loading: this.state.loading\n    }), this.props.children);\n  }\n\n}\n\nexport default UserProvider;","map":{"version":3,"sources":["/Users/insanity/Documents/Sumpixel/sumpixel/client/lib/UserProvider.tsx"],"names":["React","Component","createContext","myFirebase","getEmployer","getUser","Loading","UserContext","currentUser","changeUser","loading","setLoading","UserProvider","newUser","console","log","setState","newLoad","auth","onAuthStateChanged","userAuth","isAnonymous","firstName","lastName","email","id","uid","current","error","undefined","window","analytics","identify","name","signOut","displayName","substr","indexOf","render","state","props","children"],"mappings":"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","sourcesContent":["import React, { Component, createContext } from \"react\";\nimport { myFirebase } from \"./firebase\";\nimport {User, Employer} from '../model/model'\nimport {getEmployer, getUser} from './server'\nimport Router, {withRouter} from \"next/router\";\nimport {message} from 'antd'\nimport Loading from '../components/General/Loading'\nimport { NextPage, NextPageContext } from 'next';\n\ninterface ContextProps {\n  loading: boolean,\n  setLoading: (newLoad: boolean) => void,\n  currentUser: User | Employer | null,\n  changeUser: (newUser: User | Employer | null) => void\n}\n\nexport const UserContext = createContext<Partial<ContextProps>>({\n    currentUser: null,\n    changeUser: () => {},\n    loading: false,\n    setLoading: () => {}\n});\nclass UserProvider extends Component {\n  changeUser = (newUser: User | Employer | null) => {\n      console.log('This is current: ' + newUser)\n      this.setState({currentUser: newUser})\n  }\n\n  setLoading = (newLoad: boolean) => {\n      this.setState({loading: newLoad})\n  }\n\n  state = {\n    loading: false,\n    currentUser: null,\n    changeUser: this.changeUser,\n    setLoading: this.setLoading\n  };\n\n  componentDidMount = () => {\n    myFirebase.auth().onAuthStateChanged(async (userAuth) => {\n      //this.setLoading(true)\n      if (userAuth === null) {\n          this.setLoading(false)\n          return\n      }\n\n      if (userAuth.isAnonymous) {\n        console.log('userauth:' + userAuth)\n        this.changeUser({\n          firstName: '',\n          lastName: '',\n          email: '',\n          id: userAuth.uid,\n          isAnonymous: true\n        } as Employer)\n        this.setLoading(false)\n        return\n      }\n\n      // This is some of the worst code I've ever made\n      var current;\n      try {\n        current = await getUser(userAuth.uid)\n      } catch (error) {\n        try {\n          current = await getEmployer(userAuth.uid)\n          current[\"user_exists\"] = false\n        } catch (error) {\n          console.log(\"this better be a new user\")\n        }\n      }\n\n      if (current !== undefined && current['user_exists'] === undefined) {\n          this.changeUser(current as User)\n          window.analytics.identify(current.id, {\n            name: current.name,\n            email: current.email\n          });\n      } else if (current !== undefined && current['employer_exists'] === undefined) {\n          this.changeUser(current as Employer)\n          window.analytics.identify(current.id, {\n            name: current.name,\n            email: current.email\n          });\n      } else {\n            if (userAuth.email === null && userAuth.isAnonymous === false) {\n              // something's wrong\n              myFirebase.auth().signOut()\n              this.changeUser(undefined)\n              this.setLoading(false)\n              return\n            }\n            // In process of making account\n            console.log('name: ' + userAuth.displayName)\n            this.changeUser({\n                email: userAuth.email,\n                id: userAuth.uid,\n                firstName: userAuth.displayName.substr(0, userAuth.displayName.indexOf(' ')),\n                lastName: userAuth.displayName.substr(userAuth.displayName.indexOf(' ')+1),\n            })  \n            this.setLoading(false)\n      }\n    });\n  };\n  render() {\n    return (\n      <UserContext.Provider value={this.state}>\n        <Loading loading={this.state.loading}/>\n        {this.props.children}\n      </UserContext.Provider>\n    );\n  }\n}\nexport default UserProvider;"]},"metadata":{},"sourceType":"module"}